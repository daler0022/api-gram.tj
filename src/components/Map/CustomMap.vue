<template>
	<div>
		<l-map
      id="map"
      style="height: 100vh;"
      ref="map"
      :zoom="zoom"
      :center="center"
      :maxZoom="maxZoom"
      @click="mapClick"
      @update:zoom="zoomUpdated"
      @update:center="centerUpdated"
      @update:bounds="boundsUpdated"
      :options="{ zoomControl: false}"
      >
      <l-tile-layer :url="url" :options="{ maxNativeZoom: 18, maxZoom: 20 }" />
      <div>
        <l-polygon  
          @contextmenu="openContextMenu"
          v-for="(polygon,index) in polygons" 
          :lat-lngs="polygon.latlngs"
          :color="polygon.color" 
          @click="selectPolygon(index)"
          :fillOpacity="0"
          :key="'polygon'+index"
        />
      </div>
  
  </l-map>
  <tool-bar-map class="flex" @zoomPlus="zoomPlus" @zoomMinus="zoomMinus" @addHome="addHome" @addPolygon="addPolygon" @editPolygon="editPolygon" />
  <forms-panel :panel="selectHome" @close="close">
    <form-home :newAddress="newAddress" />
  </forms-panel>
  <forms-panel :panel="editorPolygon" @close="close">
    <form-city :coordinates="propPolygon" @update="update" @postPolygon="postPolygon" />
  </forms-panel>
  <forms-panel :panel="addDistrict">
    <form-district />
  </forms-panel>
  <!-- <form-city /> -->
  <!-- <form-route /> -->
  <!-- <context-menu :display="showContextMenu" :pageX="pageX" :pageY="pageY" ref="menu" class="drop-shadow-xl rounded-sm">
      <ul>
         <li class="py-1 px-2 flex items-center hover:bg-gray-200" @click="update()"><i class="ri-edit-2-line text-xl text-sky-700 mr-2"></i>Изменить</li>
         <li class="py-1 px-2 flex items-center hover:bg-gray-200"><i class="ri-delete-bin-5-line text-xl text-sky-700 mr-2"></i>Удалить</li> 
      </ul>
</context-menu> -->
	</div>
</template>

<script>
import {
  LMap, LTileLayer, LPolygon
} from 'vue2-leaflet'
import 'leaflet/dist/leaflet.css'
import 'leaflet-draw'
import 'leaflet-draw/dist/leaflet.draw.css'
import ToolBarMap from './ToolBarMap.vue'
import axios from 'axios'
// import FormCity from './FormCity.vue'
// import FormRoute from './FormRoute.vue'
import FormHome from './FormHome.vue'
import FormsPanel from './FormsPanel.vue'
import FormCity from './FormCity.vue'
import FormDistrict from './FormDistrictAdd.vue'
// import ContextMenu from '../ContextMenu.vue';

export default {
  name: 'custom-map',
	components: {
    LMap,
    LTileLayer,
    ToolBarMap,
    LPolygon,
    FormDistrict,
    // FormCity,
    // FormRoute,
    FormHome,
    FormsPanel,
    FormCity,
    // ContextMenu,
},
	data(){
    return {
      url: "http://{s}.tile.osm.org/{z}/{x}/{y}.png",
      zoom: 13,
      center: [40.28895415740962, 69.62061882019044],
      bounds: null,
      selectHome: false,
      editorPolygon: false,
      count: 0,
      pageX: 0,
      pageY: 0,
      showPolygon: false,
      propPolygon: [],
      indexPolygon: '',
      addDistrict: false,
      showContextMenu: false,
      polygons: [
        {
          latlngs: [{'lng': 69.642572, 'lat': 40.330437}, {'lng': 69.647108, 'lat': 40.331909}, {'lng': 69.672847, 'lat': 40.326438}, {'lng': 69.676039, 'lat': 40.326647}, {'lng': 69.677863, 'lat': 40.327158}, {'lng': 69.678109, 'lat': 40.325309}, {'lng': 69.677353, 'lat': 40.320308}, {'lng': 69.675486, 'lat': 40.313853}, {'lng': 69.673115, 'lat': 40.31}, {'lng': 69.669982, 'lat': 40.309051}, {'lng': 69.653417, 'lat': 40.302481}, {'lng': 69.650037, 'lat': 40.299903}, {'lng': 69.649458, 'lat': 40.29744}, {'lng': 69.648986, 'lat': 40.295362}, {'lng': 69.647784, 'lat': 40.294273}, {'lng': 69.646508, 'lat': 40.293594}, {'lng': 69.645435, 'lat': 40.29357}, {'lng': 69.644512, 'lat': 40.293635}, {'lng': 69.642946, 'lat': 40.293815}, {'lng': 69.642096, 'lat': 40.29392}, {'lng': 69.642121, 'lat': 40.292653}, {'lng': 69.642097, 'lat': 40.291699}, {'lng': 69.642479, 'lat': 40.291185}, {'lng': 69.642408, 'lat': 40.290849}, {'lng': 69.643241, 'lat': 40.290184}, {'lng': 69.644246, 'lat': 40.290254}, {'lng': 69.644513, 'lat': 40.288357}, {'lng': 69.643836, 'lat': 40.288279}, {'lng': 69.64378, 'lat': 40.287937}, {'lng': 69.644048, 'lat': 40.28746}, {'lng': 69.644602, 'lat': 40.287171}, {'lng': 69.644714, 'lat': 40.286979}, {'lng': 69.645897, 'lat': 40.286397}, {'lng': 69.646078, 'lat': 40.285894}, {'lng': 69.644595, 'lat': 40.285469}, {'lng': 69.643537, 'lat': 40.282976}, {'lng': 69.645105, 'lat': 40.28304}, {'lng': 69.645671, 'lat': 40.281323}, {'lng': 69.645987, 'lat': 40.281335}, {'lng': 69.646091, 'lat': 40.280095}, {'lng': 69.6446366608143, 'lat': 40.2797333683553}, {'lng': 69.6446688473225, 'lat': 40.2787387648843}, {'lng': 69.6448928117752, 'lat': 40.2781173849808}, {'lng': 69.64552, 'lat': 40.278334}, {'lng': 69.646064, 'lat': 40.277436}, {'lng': 69.646062, 'lat': 40.277411}, {'lng': 69.646004, 'lat': 40.276989}, {'lng': 69.646131, 'lat': 40.27667}, {'lng': 69.646708, 'lat': 40.276328}, {'lng': 69.647288, 'lat': 40.276095}, {'lng': 69.647784, 'lat': 40.275646}, {'lng': 69.647864, 'lat': 40.275395}, {'lng': 69.648242, 'lat': 40.274935}, {'lng': 69.648142, 'lat': 40.274519}, {'lng': 69.647825, 'lat': 40.274083}, {'lng': 69.647818, 'lat': 40.273533}, {'lng': 69.64798, 'lat': 40.272957}, {'lng': 69.647912, 'lat': 40.272437}, {'lng': 69.647885, 'lat': 40.271879}, {'lng': 69.6472531557083, 'lat': 40.2719434093965}, {'lng': 69.6477144956589, 'lat': 40.270612070952}, {'lng': 69.6486854553223, 'lat': 40.2706449438242}, {'lng': 69.6489161252976, 'lat': 40.2704025060131}, {'lng': 69.6490824222565, 'lat': 40.2685077306955}, {'lng': 69.6495813131333, 'lat': 40.2684586125393}, {'lng': 69.6498656272888, 'lat': 40.2684258670821}, {'lng': 69.6500641107559, 'lat': 40.2686223395878}, {'lng': 69.651094, 'lat': 40.268373}, {'lng': 69.651169, 'lat': 40.267734}, {'lng': 69.6518347298242, 'lat': 40.2674103581468}, {'lng': 69.652805, 'lat': 40.267083}, {'lng': 69.6529560239454, 'lat': 40.2671768854819}, {'lng': 69.6531853031213, 'lat': 40.267447077232}, {'lng': 69.6541740770855, 'lat': 40.2669675634774}, {'lng': 69.6541750317881, 'lat': 40.2669663700992}, {'lng': 69.653725, 'lat': 40.266559}, {'lng': 69.6555291023961, 'lat': 40.2655110915723}, {'lng': 69.6560819402145, 'lat': 40.2652876428988}, {'lng': 69.6576388536272, 'lat': 40.2644698399672}, {'lng': 69.6574026346207, 'lat': 40.264041925867}, {'lng': 69.6590280532837, 'lat': 40.2634115318701}, {'lng': 69.6594572067261, 'lat': 40.2643039060599}, {'lng': 69.6602243185043, 'lat': 40.2639559633952}, {'lng': 69.6599078178406, 'lat': 40.2633296620888}, {'lng': 69.6596074104309, 'lat': 40.2631822962328}, {'lng': 69.659269452095, 'lat': 40.2629162181799}, {'lng': 69.6581266638428, 'lat': 40.2631374578647}, {'lng': 69.657336, 'lat': 40.263207}, {'lng': 69.656393, 'lat': 40.263044}, {'lng': 69.654917, 'lat': 40.262661}, {'lng': 69.6540679330455, 'lat': 40.262668014421}, {'lng': 69.653613, 'lat': 40.262766}, {'lng': 69.6522686029055, 'lat': 40.2630640024625}, {'lng': 69.650264, 'lat': 40.263518}, {'lng': 69.649213, 'lat': 40.263763}, {'lng': 69.648941, 'lat': 40.263211}, {'lng': 69.644803, 'lat': 40.263035}, {'lng': 69.643611,'lat': 40.26293}, {'lng': 69.642773, 'lat': 40.262719}, {'lng': 69.6428097651031, 'lat': 40.2626951523656}, {'lng': 69.642111, 'lat': 40.262439}, {'lng': 69.642109, 'lat': 40.262436}, {'lng': 69.6421104488091, 'lat': 40.2624303846418}, {'lng': 69.643759, 'lat': 40.26069}, {'lng': 69.64379, 'lat': 40.260643}, {'lng': 69.643725, 'lat': 40.260631}, {'lng': 69.64372, 'lat': 40.260634}, {'lng': 69.638263, 'lat': 40.261955}, {'lng': 69.636914, 'lat': 40.264658}, {'lng': 69.638177, 'lat': 40.265638}, {'lng': 69.638179, 'lat': 40.265644}, {'lng': 69.637439, 'lat': 40.267765}, {'lng': 69.63648, 'lat': 40.268972}, {'lng': 69.636472, 'lat': 40.268971}, {'lng': 69.635435, 'lat': 40.268533}, {'lng': 69.635429, 'lat': 40.268558}, {'lng': 69.635178, 'lat': 40.26924}, {'lng': 69.632871, 'lat': 40.268581}, {'lng': 69.632351, 'lat': 40.269703}, {'lng': 69.626627, 'lat': 40.26859}, {'lng': 69.626241, 'lat': 40.268843}, {'lng': 69.625951, 'lat': 40.268811}, {'lng': 69.625736, 'lat': 40.269277}, {'lng': 69.622121, 'lat': 40.268344}, {'lng': 69.62181, 'lat': 40.268508}, {'lng': 69.620812, 'lat': 40.268835}, {'lng': 69.620823, 'lat': 40.268074}, {'lng': 69.619975, 'lat': 40.267926}, {'lng': 69.619477, 'lat': 40.268626}, {'lng': 69.618816, 'lat': 40.269542}, {'lng': 69.617897, 'lat': 40.269288}, {'lng': 69.617381, 'lat': 40.269301}, {'lng': 69.617273, 'lat': 40.269541}, {'lng': 69.617621, 'lat': 40.269697}, {'lng': 69.617453, 'lat': 40.269935}, {'lng': 69.617635, 'lat': 40.270074}, {'lng': 69.617363, 'lat': 40.270322}, {'lng': 69.617725, 'lat': 40.270598}, {'lng': 69.616563, 'lat': 40.271569}, {'lng': 69.616307, 'lat': 40.271563}, {'lng': 69.615024, 'lat': 40.272827}, {'lng': 69.614487, 'lat': 40.27354}, {'lng': 69.613999, 'lat': 40.273794}, {'lng': 69.613043, 'lat': 40.273388}, {'lng': 69.61262, 'lat': 40.273103}, {'lng': 69.6122, 'lat': 40.272679}, {'lng': 69.611861, 'lat': 40.271723}, {'lng': 69.610714, 'lat': 40.271376}, {'lng': 69.610405, 'lat': 40.271966}, {'lng': 69.610057, 'lat': 40.272666}, {'lng': 69.606535, 'lat': 40.272646}, {'lng': 69.606319, 'lat': 40.27282}, {'lng': 69.606173, 'lat': 40.272754}, {'lng': 69.60521, 'lat': 40.27158}, {'lng': 69.604809, 'lat': 40.271749}, {'lng': 69.60194, 'lat': 40.268447}, {'lng': 69.601157, 'lat': 40.267071}, {'lng': 69.600856, 'lat': 40.266559}, {'lng': 69.595559, 'lat': 40.267083}, {'lng': 69.594109, 'lat': 40.26936}, {'lng': 69.594226, 'lat': 40.270014}, {'lng': 69.595039, 'lat': 40.271383}, {'lng': 69.594521, 'lat': 40.272343}, {'lng': 69.590085, 'lat': 40.271684}, {'lng': 69.587554, 'lat': 40.269323}, {'lng': 69.584325, 'lat': 40.270891}, {'lng': 69.577883, 'lat': 40.266613}, {'lng': 69.573332, 'lat': 40.269736}, {'lng': 69.569879, 'lat': 40.267695}, {'lng': 69.551516, 'lat': 40.26546}, {'lng': 69.545608, 'lat': 40.26632}, {'lng': 69.545217, 'lat': 40.274484}, {'lng': 69.546826, 'lat': 40.276153}, {'lng': 69.550463, 'lat': 40.27619}, {'lng': 69.559507, 'lat': 40.282341}, {'lng': 69.567103, 'lat': 40.296614}, {'lng': 69.589376, 'lat': 40.305287}, {'lng': 69.629374, 'lat': 40.319784}, {'lng': 69.63543, 'lat': 40.325661}, {'lng': '69.642572', 'lat': '40.330437'}],
          color: '#ff0000'
        },
        {
          latlngs: [{"lng":69.649112, "lat": 40.293196},{"lng":69.650024, "lat": 40.292559},{"lng":69.650849, "lat": 40.292727},{"lng":69.651016, "lat": 40.292642},{"lng":69.651444, "lat": 40.291637},{"lng":69.651001, "lat": 40.290804},{"lng":69.651958, "lat": 40.289494},{"lng":69.652384, "lat": 40.287588},{"lng":69.651794, "lat": 40.286305},{"lng":69.651956, "lat": 40.285346},{"lng":69.651457, "lat": 40.283197},{"lng":69.6517, "lat": 40.282378},{"lng":69.651818, "lat": 40.281703},{"lng":69.651813, "lat": 40.281375},{"lng":69.651284, "lat": 40.281371},{"lng":69.6509362426021, "lat": 40.2820820610546},{"lng":69.650539, "lat": 40.28236},{"lng":69.648972, "lat": 40.282328},{"lng":69.648285, "lat": 40.281943},{"lng":69.647556, "lat": 40.281747},{"lng":69.647931, "lat": 40.280796},{"lng":69.6483210122564, "lat": 40.2792799229445},{"lng":69.6471878591896, "lat": 40.2788872235445},{"lng":69.64713, "lat": 40.278871},{"lng":69.646894, "lat": 40.280303},{"lng":69.646111, "lat": 40.280115},{"lng":69.645993, "lat": 40.281351},{"lng":69.645703, "lat": 40.281343},{"lng":69.645123, "lat": 40.283062},{"lng":69.643579, "lat": 40.282996},{"lng":69.644608, "lat": 40.285419},{"lng":69.646111, "lat": 40.285885},{"lng":69.645923, "lat": 40.286409},{"lng":69.644753, "lat": 40.287006},{"lng":69.644641, "lat": 40.287154},{"lng":69.644072, "lat": 40.287477},{"lng":69.643831, "lat": 40.287911},{"lng":69.643881, "lat": 40.288233},{"lng":69.644544, "lat": 40.288332},{"lng":69.644405, "lat": 40.289552},{"lng":69.644276, "lat": 40.290288},{"lng":69.643246, "lat": 40.290223},{"lng":69.642452, "lat": 40.290861},{"lng":69.642516, "lat": 40.291201},{"lng":69.642128, "lat": 40.29171},{"lng":69.642164, "lat": 40.293846},{"lng":69.649112, "lat": 40.293196}],
          color: '#0A7B10'
        },
        {
          latlngs: [{"lng":69.658427, "lat": 40.303528},{"lng":69.659017, "lat": 40.30325},{"lng":69.659393, "lat": 40.302734},{"lng":69.660047, "lat": 40.300329},{"lng":69.660916, "lat": 40.2983},{"lng":69.661775, "lat": 40.296917},{"lng":69.66362, "lat": 40.295722},{"lng":69.665358, "lat": 40.29501},{"lng":69.668416, "lat": 40.294781},{"lng":69.671388, "lat": 40.294257},{"lng":69.67658, "lat": 40.293472},{"lng":69.676076, "lat": 40.292346},{"lng":69.675526, "lat": 40.291192},{"lng":69.675199, "lat": 40.29048},{"lng":69.674601, "lat": 40.290517},{"lng":69.674518, "lat": 40.290163},{"lng":69.675035, "lat": 40.290063},{"lng":69.674555, "lat": 40.288979},{"lng":69.673979, "lat": 40.287688},{"lng":69.673871, "lat": 40.287315},{"lng":69.671956, "lat": 40.28753},{"lng":69.669178, "lat": 40.286974},{"lng":69.668469, "lat": 40.286671},{"lng":69.667246, "lat": 40.285713},{"lng":69.666463, "lat": 40.285353},{"lng":69.665809, "lat": 40.285345},{"lng":69.665422, "lat": 40.28451},{"lng":69.663438, "lat": 40.28451},{"lng":69.662912, "lat": 40.284289},{"lng":69.662193, "lat": 40.284117},{"lng":69.659382, "lat": 40.28361},{"lng":69.659321, "lat": 40.281791},{"lng":69.65557, "lat": 40.28124},{"lng":69.6556008850739, "lat": 40.2809019336505},{"lng":69.6553035325784, "lat": 40.2808600653517},{"lng":69.6519591578434, "lat": 40.2803389799724},{"lng":69.652104, "lat": 40.281035},{"lng":69.651869, "lat": 40.281253},{"lng":69.651893, "lat": 40.28176},{"lng":69.651797, "lat": 40.282444},{"lng":69.651523, "lat": 40.283184},{"lng":69.651711, "lat": 40.283978},{"lng":69.651861, "lat": 40.284518},{"lng":69.651968, "lat": 40.28532},{"lng":69.651861, "lat": 40.286286},{"lng":69.652033, "lat": 40.286744},{"lng":69.652441, "lat": 40.287563},{"lng":69.652226, "lat": 40.288512},{"lng":69.652011, "lat": 40.289494},{"lng":69.651067, "lat": 40.290796},{"lng":69.651491, "lat": 40.291651},{"lng":69.651046, "lat": 40.292698},{"lng":69.65081, "lat": 40.292747},{"lng":69.650161, "lat": 40.292608},{"lng":69.649828, "lat": 40.292743},{"lng":69.649222, "lat": 40.293226},{"lng":69.65066, "lat": 40.295632},{"lng":69.652205, "lat": 40.298921},{"lng":69.653138, "lat": 40.300165},{"lng":69.655573, "lat": 40.302113},{"lng":69.656689, "lat": 40.303193},{"lng":69.657204, "lat": 40.303454},{"lng":69.657859, "lat": 40.30361},{"lng":69.658427, "lat": 40.303528}],
          color: '#fff000'
        },
        {
          latlngs: [{"lng":69.6664260256904, "lat": 40.2820012592391},{"lng":69.665610701992, "lat": 40.2819000876938},{"lng":69.6612044286074, "lat": 40.2812340501411},{"lng":69.661198, "lat": 40.28123},{"lng":69.661193, "lat": 40.281218},{"lng":69.661194, "lat": 40.281213},{"lng":69.661199, "lat": 40.281211},{"lng":69.661517, "lat": 40.281162},{"lng":69.6616938810417, "lat": 40.2796350232964},{"lng":69.661619, "lat": 40.279039},{"lng":69.661158, "lat": 40.276853},{"lng":69.661338, "lat": 40.276734},{"lng":69.661785, "lat": 40.276729},{"lng":69.661919, "lat": 40.276162},{"lng":69.6621447864775, "lat": 40.2747384395763},{"lng":69.662064, "lat": 40.274508},{"lng":69.662225, "lat": 40.274351},{"lng":69.662547, "lat": 40.273006},{"lng":69.663089, "lat": 40.270771},{"lng":69.662559, "lat": 40.270728},{"lng":69.662554, "lat": 40.270726},{"lng":69.662552, "lat": 40.270722},{"lng":69.662558, "lat": 40.270697},{"lng":69.661019, "lat": 40.270421},{"lng":69.655691, "lat": 40.269623},{"lng":69.655525, "lat": 40.269605},{"lng":69.655519, "lat": 40.269603},{"lng":69.655517, "lat": 40.269597},{"lng":69.654652, "lat": 40.269687},{"lng":69.654619, "lat": 40.269683},{"lng":69.654508, "lat": 40.269695},{"lng":69.653591, "lat": 40.269745},{"lng":69.653586, "lat": 40.269742},{"lng":69.653585, "lat": 40.269738},{"lng":69.653688, "lat": 40.268507},{"lng":69.653406, "lat": 40.268259},{"lng":69.652982, "lat": 40.268155},{"lng":69.65298, "lat": 40.268151},{"lng":69.653, "lat": 40.267829},{"lng":69.652998, "lat": 40.267828},{"lng":69.652445, "lat": 40.267928},{"lng":69.652437, "lat": 40.267927},{"lng":69.651995, "lat": 40.26775},{"lng":69.651831, "lat": 40.267419},{"lng":69.651177, "lat": 40.267738},{"lng":69.651102, "lat": 40.268374},{"lng":69.651098, "lat": 40.268378},{"lng":69.650065, "lat": 40.268628},{"lng":69.650058, "lat": 40.268626},{"lng":69.649863, "lat": 40.268433},{"lng":69.649582, "lat": 40.268465},{"lng":69.64909, "lat": 40.268513},{"lng":69.648923, "lat": 40.270406},{"lng":69.648692, "lat": 40.270649},{"lng":69.648686, "lat": 40.270651},{"lng":69.64772, "lat": 40.270618},{"lng":69.647264, "lat": 40.271936},{"lng":69.647884, "lat": 40.271873},{"lng":69.647889, "lat": 40.271874},{"lng":69.647893, "lat": 40.271878},{"lng":69.64792, "lat": 40.272437},{"lng":69.647956, "lat": 40.272712},{"lng":69.647967, "lat": 40.272715},{"lng":69.64801, "lat": 40.272961},{"lng":69.647846, "lat": 40.273533},{"lng":69.64787, "lat": 40.274091},{"lng":69.64816, "lat": 40.2745},{"lng":69.648267, "lat": 40.274942},{"lng":69.647902, "lat": 40.275408},{"lng":69.647827, "lat": 40.275629},{"lng":69.647516, "lat": 40.275965},{"lng":69.647285, "lat": 40.276121},{"lng":69.646711, "lat": 40.276358},{"lng":69.646148, "lat": 40.276694},{"lng":69.646034, "lat": 40.276986},{"lng":69.646073, "lat": 40.277447},{"lng":69.645562, "lat": 40.278317},{"lng":69.645543, "lat": 40.278311},{"lng":69.645527, "lat": 40.278338},{"lng":69.645523, "lat": 40.27834},{"lng":69.645517, "lat": 40.27834},{"lng":69.644898, "lat": 40.278126},{"lng":69.644677, "lat": 40.27874},{"lng":69.644645, "lat": 40.279729},{"lng":69.646887, "lat": 40.280295},{"lng":69.647122, "lat": 40.27887},{"lng":69.647124, "lat": 40.278867},{"lng":69.647128, "lat": 40.278865},{"lng":69.647133, "lat": 40.278865},{"lng":69.647191, "lat": 40.278881},{"lng":69.648326, "lat": 40.279275},{"lng":69.648329, "lat": 40.279278},{"lng":69.647939, "lat": 40.280797},{"lng":69.647566, "lat": 40.281743},{"lng":69.648289, "lat": 40.281938},{"lng":69.648975, "lat": 40.282322},{"lng":69.650536, "lat": 40.282354},{"lng":69.650929, "lat": 40.282078},{"lng":69.651278, "lat": 40.281367},{"lng":69.651284, "lat": 40.281365},{"lng":69.651813, "lat": 40.281369},{"lng":69.651819, "lat": 40.281371},{"lng":69.651821, "lat": 40.281375},{"lng":69.651863, "lat": 40.281249},{"lng":69.652095, "lat": 40.281033},{"lng":69.651951, "lat": 40.28034},{"lng":69.651953, "lat": 40.280335},{"lng":69.651959, "lat": 40.280333},{"lng":69.655306, "lat": 40.280854},{"lng":69.655604, "lat": 40.280896},{"lng":69.655608, "lat": 40.280899},{"lng":69.655609, "lat": 40.280902},{"lng":69.655579, "lat": 40.281235},{"lng":69.659324, "lat": 40.281785},{"lng":69.659328, "lat": 40.281787},{"lng":69.659329, "lat": 40.281791},{"lng":69.659334, "lat": 40.281926},{"lng":69.660079, "lat": 40.282347},{"lng":69.6610168042373, "lat": 40.2824219843473},{"lng":69.661077, "lat": 40.281968},{"lng":69.661079660114, "lat": 40.2819643690338},{"lng":69.6610852187198, "lat": 40.2819628345622},{"lng":69.663154, "lat": 40.282306},{"lng":69.663159, "lat": 40.282308},{"lng":69.6631600140582, "lat": 40.2823128143306},{"lng":69.663018004331, "lat": 40.2831261427924},{"lng":69.6640617713959, "lat": 40.2832936974827},{"lng":69.6642910922712, "lat": 40.2824717161111},{"lng":69.664294440722, "lat": 40.2824679066137},{"lng":69.6643003106057, "lat": 40.2824669139288},{"lng":69.6755593106057, "lat": 40.2838779140558},{"lng":69.675565, "lat": 40.28388},{"lng":69.6755660114525, "lat": 40.2838848290981},{"lng":69.6754980757006, "lat": 40.2842675736276},{"lng":69.6758759751009, "lat": 40.2843499945986},{"lng":69.676077, "lat": 40.283889},{"lng":69.67608, "lat": 40.283886},{"lng":69.6760847684147, "lat": 40.2838848350109},{"lng":69.6797613423617, "lat": 40.2843799179318},{"lng":69.681377, "lat": 40.284577},{"lng":69.681555, "lat": 40.284575},{"lng":69.6823859033689, "lat": 40.2845542274158},{"lng":69.682504, "lat": 40.284548},{"lng":69.682515, "lat": 40.28432},{"lng":69.680997, "lat": 40.284313},{"lng":69.68081, "lat": 40.284287},{"lng":69.679725, "lat": 40.28427},{"lng":69.679759, "lat": 40.283872},{"lng":69.6794587557537, "lat": 40.2838296342475},{"lng":69.6688297177731, "lat": 40.2825180895879},{"lng":69.6664547264948, "lat": 40.2822290906752},{"lng":69.6664495519705, "lat": 40.2822267206983},{"lng":69.6664479371694, "lat": 40.2822234547628},{"lng":69.6664431465254, "lat": 40.2821740240289},{"lng":69.6664260256904, "lat": 40.2820012592391}],
          color: '#3374FF'
        },
        {
          latlngs: [{"lng":69.679797736827, "lat": 40.284187873766},{"lng":69.67992, "lat": 40.283034},{"lng":69.680207, "lat": 40.282446},{"lng":69.68089, "lat": 40.281037},{"lng":69.68137, "lat": 40.280032},{"lng":69.681981, "lat": 40.278531},{"lng":69.682415, "lat": 40.277593},{"lng":69.683089, "lat": 40.276627},{"lng":69.685497, "lat": 40.274425},{"lng":69.685189, "lat": 40.274189},{"lng":69.685926, "lat": 40.273001},{"lng":69.684327, "lat": 40.272631},{"lng":69.682471, "lat": 40.272506},{"lng":69.68115, "lat": 40.27262},{"lng":69.676709, "lat": 40.272142},{"lng":69.674563, "lat": 40.271357},{"lng":69.672986, "lat": 40.271152},{"lng":69.671549, "lat": 40.271078},{"lng":69.670948, "lat": 40.270996},{"lng":69.665294, "lat": 40.270906},{"lng":69.663095, "lat": 40.270782},{"lng":69.662555, "lat": 40.273007},{"lng":69.662233, "lat": 40.274354},{"lng":69.662073, "lat": 40.274509},{"lng":69.662153, "lat": 40.274738},{"lng":69.661927, "lat": 40.276163},{"lng":69.661793, "lat": 40.276731},{"lng":69.661791, "lat": 40.276734},{"lng":69.661785, "lat": 40.276736},{"lng":69.661382, "lat": 40.27674},{"lng":69.661388, "lat": 40.276759},{"lng":69.661291, "lat": 40.276773},{"lng":69.661167, "lat": 40.276855},{"lng":69.661627, "lat": 40.279038},{"lng":69.661702, "lat": 40.279635},{"lng":69.661525, "lat": 40.281165},{"lng":69.661519, "lat": 40.281169},{"lng":69.661201, "lat": 40.281217},{"lng":69.661206, "lat": 40.281228},{"lng":69.6656116755082, "lat": 40.2818940363237},{"lng":69.6664340054483, "lat": 40.2819964659247},{"lng":69.6664564527495, "lat": 40.2822226520185},{"lng":69.66883126883, "lat": 40.2825117833221},{"lng":69.6797964173215, "lat": 40.2838646130833},{"lng":69.6797400712967, "lat": 40.2842451780445},{"lng":69.6825389622944, "lat": 40.2843137833542},{"lng":69.6825293330462, "lat": 40.2845531890184},{"lng":69.6815437802808, "lat": 40.2846042780755},{"lng":69.6797604466602, "lat": 40.2843864677163},{"lng":69.6760847442845, "lat": 40.2838914660864},{"lng":69.6758808367074, "lat": 40.2843578313572},{"lng":69.67548911952, "lat": 40.284271922207},{"lng":69.6755578751794, "lat": 40.2838839808751},{"lng":69.6642985665083, "lat": 40.2824731883777},{"lng":69.6640679672208, "lat": 40.2833009280304},{"lng":69.6630091709064, "lat": 40.2831305474216},{"lng":69.6631518769928, "lat": 40.2823116163334},{"lng":69.6610854638967, "lat": 40.2819686980985},{"lng":69.6610235932282, "lat": 40.2824290762883},{"lng":69.6600758270149, "lat": 40.2823532678571},{"lng":69.6592922135642, "lat": 40.2819095179136},{"lng":69.659391, "lat": 40.283605},{"lng":69.662195, "lat": 40.284111},{"lng":69.662914, "lat": 40.284283},{"lng":69.663282, "lat": 40.284437},{"lng":69.663448, "lat": 40.284502},{"lng":69.664822, "lat": 40.284486},{"lng":69.6650766089958, "lat": 40.2845038325367},{"lng":69.665425, "lat": 40.284504},{"lng":69.66543, "lat": 40.284508},{"lng":69.6654393926366, "lat": 40.2845290245398},{"lng":69.665471, "lat": 40.284531},{"lng":69.665663, "lat": 40.285011},{"lng":69.6658143330719, "lat": 40.2853380045976},{"lng":69.666466, "lat": 40.285347},{"lng":69.66725017343, "lat": 40.2857077178756},{"lng":69.668474, "lat": 40.286666},{"lng":69.669153, "lat": 40.286956},{"lng":69.6692368815595, "lat": 40.2869794088073},{"lng":69.6696437307573, "lat": 40.2870608372357},{"lng":69.670953, "lat": 40.287285},{"lng":69.67172, "lat": 40.287476},{"lng":69.6719564555039, "lat": 40.287523715232},{"lng":69.672749, "lat": 40.287433},{"lng":69.674045, "lat": 40.287269},{"lng":69.674018689368, "lat": 40.2877578151382},{"lng":69.6745626537215, "lat": 40.2889770130537},{"lng":69.6750430269764, "lat": 40.2900622635124},{"lng":69.6750421014602, "lat": 40.2900659477159},{"lng":69.6750369872348, "lat": 40.2900689777609},{"lng":69.6745272837738, "lat": 40.2901675664304},{"lng":69.6746076657486, "lat": 40.2905104004005},{"lng":69.6751983463414, "lat": 40.2904738532701},{"lng":69.6752059968816, "lat": 40.290476910217},{"lng":69.6755336145172, "lat": 40.2911899270151},{"lng":69.676083598326, "lat": 40.2923438930786},{"lng":69.6765880061247, "lat": 40.2934711415961},{"lng":69.6765873542868, "lat": 40.2934745616169},{"lng":69.6765830365903, "lat": 40.2934777151579},{"lng":69.6765312902222, "lat": 40.2934856512631},{"lng":69.676698, "lat": 40.293504},{"lng":69.680478, "lat": 40.292627},{"lng":69.683599, "lat": 40.291301},{"lng":69.683822, "lat": 40.28926},{"lng":69.683028, "lat": 40.288663},{"lng":69.683243, "lat": 40.286518},{"lng":69.68319, "lat": 40.286422},{"lng":69.683007, "lat": 40.286391},{"lng":69.683001, "lat": 40.286387},{"lng":69.68292, "lat": 40.285684},{"lng":69.682878, "lat": 40.285517},{"lng":69.682953, "lat": 40.284698},{"lng":69.682846069336, "lat": 40.2842615862304},{"lng":69.679797736827, "lat": 40.284187873766}],
          color: '#FF9933'
        },
        {
          latlngs: [{"lng":69.601897, "lat": 40.268352},{"lng":69.604837, "lat": 40.2717},{"lng":69.605234, "lat": 40.271549},{"lng":69.606194, "lat": 40.272736},{"lng":69.606323, "lat": 40.272785},{"lng":69.606537, "lat": 40.272613},{"lng":69.610035, "lat": 40.272638},{"lng":69.610684, "lat": 40.27134},{"lng":69.611886, "lat": 40.2717},{"lng":69.612229, "lat": 40.272658},{"lng":69.612631, "lat": 40.273076},{"lng":69.613109, "lat": 40.273387},{"lng":69.61401, "lat": 40.273763},{"lng":69.61446, "lat": 40.273518},{"lng":69.614831, "lat": 40.273031},{"lng":69.614997, "lat": 40.272781},{"lng":69.616284, "lat": 40.271537},{"lng":69.616585, "lat": 40.27152},{"lng":69.617636, "lat": 40.270636},{"lng":69.617314, "lat": 40.270325},{"lng":69.617572, "lat": 40.270063},{"lng":69.6174, "lat": 40.269932},{"lng":69.617572, "lat": 40.269703},{"lng":69.617207, "lat": 40.269556},{"lng":69.617357, "lat": 40.269265},{"lng":69.617904, "lat": 40.269261},{"lng":69.618811, "lat": 40.26947},{"lng":69.619964, "lat": 40.267902},{"lng":69.615866, "lat": 40.267239},{"lng":69.612551, "lat": 40.266682},{"lng":69.609257, "lat": 40.26606},{"lng":69.607133, "lat": 40.265389},{"lng":69.606864, "lat": 40.266232},{"lng":69.604601, "lat": 40.266085},{"lng":69.6042837674232, "lat": 40.2655562790387},{"lng":69.6032973267831, "lat": 40.2661569145679},{"lng":69.602884, "lat": 40.266445},{"lng":69.602627, "lat": 40.266674},{"lng":69.602047, "lat": 40.266838},{"lng":69.601629, "lat": 40.267173},{"lng":69.601436, "lat": 40.267542},{"lng":69.601897, "lat": 40.268352}],
          color: '#9C33FF'
        },
        {
          latlngs: [{"lng":69.623143, "lat": 40.26737},{"lng":69.6231481668578, "lat": 40.267371323931},{"lng":69.62409, "lat": 40.267677},{"lng":69.624369, "lat": 40.267789},{"lng":69.6243120848376, "lat": 40.2679287916271},{"lng":69.626777, "lat": 40.268442},{"lng":69.6266407095948, "lat": 40.2685555417059},{"lng":69.6266416018429, "lat": 40.2685563133795},{"lng":69.632324, "lat": 40.269668},{"lng":69.632847, "lat": 40.268551},{"lng":69.635157, "lat": 40.269186},{"lng":69.635409, "lat": 40.268515},{"lng":69.636476, "lat": 40.268966},{"lng":69.637431, "lat": 40.267763},{"lng":69.638171, "lat": 40.265642},{"lng":69.636905, "lat": 40.26466},{"lng":69.638257, "lat": 40.26195},{"lng":69.643718, "lat": 40.260628},{"lng":69.644908, "lat": 40.258777},{"lng":69.645374, "lat": 40.257111},{"lng":69.645277, "lat": 40.256723},{"lng":69.644427, "lat": 40.255701},{"lng":69.640342, "lat": 40.257128},{"lng":69.638411, "lat": 40.257393},{"lng":69.636519, "lat": 40.258401},{"lng":69.634419, "lat": 40.258995},{"lng":69.632427, "lat": 40.25936},{"lng":69.631215, "lat": 40.259295},{"lng":69.629778, "lat": 40.258663},{"lng":69.627662, "lat": 40.259011},{"lng":69.625945, "lat": 40.258707},{"lng":69.624492, "lat": 40.25902},{"lng":69.623108, "lat": 40.25879},{"lng":69.6228462374036, "lat": 40.2587222357888},{"lng":69.6201005273181, "lat": 40.2583775716957},{"lng":69.616583639914, "lat": 40.2571009958392},{"lng":69.616236, "lat": 40.257011},{"lng":69.6162147052496, "lat": 40.2570663929458},{"lng":69.6162372755686, "lat": 40.2570703591064},{"lng":69.6162408465177, "lat": 40.2570727184618},{"lng":69.6162420806802, "lat": 40.2570761978397},{"lng":69.6160401286507, "lat": 40.2618800567871},{"lng":69.6164066919708, "lat": 40.2626864961476},{"lng":69.6170662367364, "lat": 40.2624496104492},{"lng":69.6171882271513, "lat": 40.2621243026615},{"lng":69.617191558415, "lat": 40.2621208448988},{"lng":69.6179438218935, "lat": 40.2618753271318},{"lng":69.6179484039166, "lat": 40.2618749242014},{"lng":69.6179535570096, "lat": 40.2618773907601},{"lng":69.6180963419131, "lat": 40.262113416618},{"lng":69.6180965862795, "lat": 40.2621181329806},{"lng":69.6180923902587, "lat": 40.2621216008707},{"lng":69.6177168751565, "lat": 40.2622539625824},{"lng":69.6185932718417, "lat": 40.2636303037375},{"lng":69.6185939908631, "lat": 40.2636339379058},{"lng":69.6185892224873, "lat": 40.2636386581228},{"lng":69.61839356074, "lat": 40.2637035459418},{"lng":69.6177791270839, "lat": 40.2639603831464},{"lng":69.6181511611869, "lat": 40.264453475977},{"lng":69.6186638971736, "lat": 40.2645288491653},{"lng":69.6188302536515, "lat": 40.2645328337519},{"lng":69.6188357251711, "lat": 40.2645346440206},{"lng":69.6188380815628, "lat": 40.2645388244249},{"lng":69.6186899810488, "lat": 40.265237985341},{"lng":69.6186868682763, "lat": 40.2652419254059},{"lng":69.6186810481173, "lat": 40.2652431263129},{"lng":69.6172364722624, "lat": 40.2651124361061},{"lng":69.6168491275921, "lat": 40.2653555146314},{"lng":69.6166761829624, "lat": 40.265842009268},{"lng":69.6175367103648, "lat": 40.2668041843662},{"lng":69.61880826034, "lat": 40.2671856493953},{"lng":69.6193981283345, "lat": 40.2652645926801},{"lng":69.6194021224245, "lat": 40.2652605866258},{"lng":69.6194070490193, "lat": 40.2652598829324},{"lng":69.6221125032505, "lat": 40.2655301339635},{"lng":69.6221161733745, "lat": 40.2655320164284},{"lng":69.6221180793797, "lat": 40.2655362266453},{"lng":69.6220323426297, "lat": 40.2673157627423},{"lng":69.6223312653788, "lat": 40.2673519069994},{"lng":69.6223372294608, "lat": 40.2673552383242},{"lng":69.6223380398576, "lat": 40.2673586498317},{"lng":69.6222796305373, "lat": 40.2677793949445},{"lng":69.6224938548124, "lat": 40.2678620446392},{"lng":69.622495657131, "lat": 40.2678615940595},{"lng":69.623140577304, "lat": 40.267371840353},{"lng":69.623143, "lat": 40.26737}],
          color: '#4B0A7B'
        }
      ],
      newAddress: {
          lat: '',
          lng: '',
          house_number: '', 
          street: ''
      },
      maxZoom: 20,
      polygon: [{
        "type": "Feature",
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            []
          ]
        }
      }]
    }
  },
  mounted() {
   
  },
	methods: {
    zoomUpdated(zoom) {
      this.zoom = zoom;
    },
    centerUpdated(center) {
      this.center = center;
    },
    boundsUpdated(bounds) {
      this.bounds = bounds;
    },
    zoomPlus() {
      this.zoom++
    },
    zoomMinus() {
      this.zoom--
    },
    addHome() {
      this.selectHome = !this.selectHome 
    },
    close() {
      this.selectHome = false
      this.editorPolygon = false
    },
    openContextMenu(e) {
      this.$refs.menu.open(e);
      this.pageX = e.containerPoint.x;
      this.pageY = e.containerPoint.y;
    },
    mapClick(e) {
      if(this.selectHome) {
        axios
        .get(`https://nominatim.openstreetmap.org/reverse?format=geojson&lat=${e.latlng.lat}&lon=${e.latlng.lng}`)
        .then(res => {
          console.log('address',res);
          this.newAddress.lat=e.latlng.lat
          this.newAddress.lng=e.latlng.lng
          this.newAddress.street=res.data.features[0].properties.address.road
          this.newAddress.house_number=res.data.features[0].properties.address.house_number
          // this.latLng.address = res.data.features[0].properties.address
          console.log(this.newAddress);
        })
        this.markerLatLng=e.latlng
      }
      else {
        console.log("no");
      }
    },
    update() {
      this.$router.go()
    },
    selectPolygon(index) {
      if (this. editorPolygon && this.count < 1){
        this.count++
        const map = this.$refs.map.mapObject;
        var drawnItems = new window.L.FeatureGroup();
        map.addLayer(drawnItems);
        var drawControl = new window.L.Control.Draw({
          draw: {
            polygon: false,      
            rectangle: false,
            circle: false,
            marker: false,
            polyline: false,
            circlemarker: false
          },
          edit: {
            featureGroup: drawnItems
          }
        });
        
        map.addControl(drawControl);

        this.polygon[0].geometry.coordinates[0] = []
        let removedPolygon = this.polygons.splice(index, 1)
        this.propPolygon = JSON.stringify(removedPolygon[0].latlngs) 
        removedPolygon[0].latlngs.forEach(element => {
          this.polygon[0].geometry.coordinates[0].push([element.lng, element.lat])
        })
        map.on("draw:edited", (e) => {
          let layers = e.layers;
          layers.eachLayer((layer) => {
            this.propPolygon = layer._latlngs[0]
            this.propPolygon = []
            layer._latlngs[0].forEach(el => { 
              this.propPolygon.push({'lat': el.lat, 'lng': el.lng,})  
            })
            this.propPolygon = JSON.stringify(this.propPolygon) 
          });
        })
      
      var geojsonLayer = window.L.geoJson(this.polygon);
      geojsonLayer.getLayers()[0].addTo(drawnItems);
      document.querySelector('.leaflet-draw-edit-edit').click()
      }
    },
    postPolygon() {
      document.querySelector('.leaflet-draw-actions li:first-child a').click()
      this.axios.post('https://sip.gram.tj/api/addresses/cities', {
        region_id: 2,
        name: 'Худжанд',
        name_ru: 'Худжанд',
        coordinates: this.propPolygon
      })
      .then(res => {
        this.update()
        console.log(res);
      })
      .catch(err => {
        console.log(err);
        
      })
    },
    editPolygon() {
      this.editorPolygon = !this.editorPolygon
      
    },
    addPolygon() {
            this.addDistrict = true
            const map = this.$refs.map.mapObject;
            var drawnItems = new window.L.FeatureGroup()
            map.addLayer(drawnItems)

            map.on('draw:created', (e) => {
              var type = e.layerType,
                    layer = e.layer;
                    console.log(layer._latlngs[0]);
                
                if (type === 'marker') {
                  layer.bindPopup('A popup!');
                }
                
                drawnItems.addLayer(layer);
            });
            const polygon_options = {
              showArea: false,
              shapeOptions: {
                stroke: true,
                color: '#6e83f0',
                weight: 4,
                opacity: 0.5,
                fill: true,
                fillColor: null, //same as color by default
                fillOpacity: 0.2,
                clickable: true
              }
            }
            var polygonDrawer = new window.L.Draw.Polygon(map, polygon_options);     
            polygonDrawer.enable();
            // map.on('draw:edited', (e) => {
              //     // Update db to save latest changes.
            //     var layers = e.layers;
                
            //     layers.eachLayer((layer) => {
              //         const lattitude = JSON.stringify(layer.getLatLngs()[0]) 
            //         console.log(layer);
            //         this.longitudeLattitude = lattitude
            //     });
            // });
            // let poly = L.polygon([{"lat":50.090442692166135,"lng":6.8115234375},{"lat":49.165903234689395,"lng":8.964843750000002},{"lat":49.9917194319911,"lng":9.492187500000002}], {color: 'red'});
            // map.addLayer(poly)
            // poly.addTo(map)
    }
  }
}
</script>

<style>
.leaflet-top{
  display: none;
}
.leaflet-marker-icon {
  width: 10px!important;
  height: 10px!important;
  margin-left: -5px!important;
  margin-top: -5px!important;
}
</style>